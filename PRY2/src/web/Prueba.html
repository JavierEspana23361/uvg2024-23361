<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Series Recommendation System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h2>TV Series Recommendation System</h2>
        <div id="login" class="options">
            <button onclick="showLogin()">Iniciar sesión</button>
        </div>
        <div id="register" class="options">
            <button onclick="showRegister()">Registrarse</button>
        </div>
        <div id="loginForm" style="display: none;">
            <input type="text" id="username" placeholder="Nombre de usuario">
            <input type="password" id="password" placeholder="Contraseña">
            <button onclick="login()">Iniciar sesión</button>
        </div>
        <div id="registerForm" style="display: none;">
            <input type="text" id="newUsername" placeholder="Nuevo nombre de usuario">
            <input type="password" id="newPassword" placeholder="Nueva contraseña">
            <button onclick="register()">Registrarse</button>
        </div>
        <div id="userOptions" style="display: none;" class="options">
            <h3>Bienvenido <span id="loggedInUser"></span></h3>
            <div>
                <button onclick="recommend()">Ver series recomendadas</button>
            </div>
            <div>
                <button onclick="insertSeries()">Insertar serie</button>
            </div>
            <div>
                <button onclick="connectSeriesGenre()">Unir serie a género</button>
            </div>
            <div>
                <button onclick="addSeriesToUser()">Añadir series a usuario</button>
            </div>
            <div>
                <button onclick="addGenreToUser()">Añadir género a usuario</button>
            </div>
            <div>
                <button onclick="logout()">Salir</button>
            </div>
        </div>
    </div>

    <script>
        const uri = "bolt://localhost:7687";
        const user = "neo4j";
        const password = "password";
        const databaseName = "neo4j2";

        function showLogin() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('register').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('register').style.display = 'none';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch(`/login?username=${username}&password=${password}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('loggedInUser').innerText = username;
                        document.getElementById('loginForm').style.display = 'none';
                        document.getElementById('userOptions').style.display = 'block';
                    } else {
                        alert('Usuario no encontrado');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function register() {
            const newUsername = document.getElementById('newUsername').value;
            const newPassword = document.getElementById('newPassword').value;

            fetch(`/register?username=${newUsername}&password=${newPassword}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Registrado exitosamente. Por favor inicie sesión.');
                        showLogin();
                    } else {
                        alert('Error al registrar usuario');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function recommend() {
            const username = document.getElementById('loggedInUser').innerText;

            fetch(`/recommend?username=${username}`)
                .then(response => response.json())
                .then(data => {
                    const recommendations = data.recommendations;
                    if (recommendations.length === 0) {
                        alert('No hay series recomendadas');
                    } else {
                        alert('Series recomendadas: ' + recommendations.join(', '));
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function insertSeries() {
            const title = prompt('Ingrese el nombre de la serie:');
            const releaseYear = prompt('Ingrese el año de la serie:');
            const tagline = prompt('Ingrese la tagline de la serie:');

            fetch(`/insertSeries?title=${title}&releaseYear=${releaseYear}&tagline=${tagline}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Serie insertada correctamente.');
                    } else {
                        alert('Error al insertar la serie.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function connectSeriesGenre() {
            const title = prompt('Ingrese el nombre de la serie:');
            const genre = prompt('Ingrese el género de la serie:');

            fetch(`/connectSeriesGenre?title=${title}&genre=${genre}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Serie conectada al género correctamente.');
                    } else {
                        alert('Error al conectar serie y género.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function addSeriesToUser() {
            const title = prompt('Seleccione la serie que desea agregar:');

            fetch(`/addSeriesToUser?username=${username}&title=${title}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Serie añadida al usuario correctamente.');
                    } else {
                        alert('Error al añadir serie al usuario.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function addGenreToUser() {
            const genre = prompt('Seleccione el género que desea agregar:');

            fetch(`/addGenreToUser?username=${username}&genre=${genre}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Género añadido al usuario correctamente.');
                    } else {
                        alert('Error al añadir género al usuario.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function logout() {
            document.getElementById('userOptions').style.display = 'none';
            document.getElementById('login').style.display = 'block';
            document.getElementById('register').style.display = 'block';
        }
    </script>
</body>
</html>
